{% extends "base.html" %}

{% block title %}Create Project - The Grey Canvas{% endblock %}

{% block extra_css %}
/* Project Creation Form Styles */
.form-container {
    background: linear-gradient(135deg, rgba(55, 65, 81, 0.85), rgba(31, 41, 55, 0.80));
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    padding: 2rem;
    backdrop-filter: blur(12px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-label {
    display: block;
    color: white;
    font-weight: 600;
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
}

.form-input {
    width: 100%;
    background: rgba(31, 41, 55, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    color: white;
    font-size: 0.875rem;
}

.form-input:focus {
    outline: none;
    border-color: rgba(224, 33, 138, 0.5);
    box-shadow: 0 0 0 2px rgba(224, 33, 138, 0.1);
}

.form-textarea {
    min-height: 100px;
    resize: vertical;
}

.form-select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.5rem center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
}

.btn-submit {
    background: linear-gradient(135deg, #e0218a, #f472b6);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
}

.btn-submit:hover {
    background: linear-gradient(135deg, #be185d, #e0218a);
    transform: translateY(-1px);
    box-shadow: 0 8px 20px rgba(224, 33, 138, 0.3);
}

.btn-cancel {
    background: rgba(107, 114, 128, 0.2);
    color: #9ca3af;
    border: 1px solid rgba(107, 114, 128, 0.3);
    border-radius: 8px;
    padding: 0.75rem 1.5rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
    text-align: center;
    width: 100%;
}

.btn-cancel:hover {
    background: rgba(107, 114, 128, 0.3);
    color: white;
}

.prefilled-notice {
    background: rgba(34, 197, 94, 0.1);
    border: 1px solid rgba(34, 197, 94, 0.3);
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 1.5rem;
    color: #86efac;
    font-size: 0.875rem;
}

@media (max-width: 768px) {
    .form-container {
        padding: 1.5rem;
        margin: 1rem;
    }
}
{% endblock %}

{% block content %}
<main class="w-full max-w-2xl main-content-container p-6 md:p-8 my-5 mx-auto">
    <!-- Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl md:text-5xl font-playfair text-white mb-4">
            Create New Project
        </h1>
        <p class="text-lg text-gray-300 mb-6">
            Convert intake submission to tracked project
        </p>
    </div>

    {% if intake_submission %}
    <div class="prefilled-notice">
        <strong>ðŸ“‹ Intake Submission Detected</strong><br>
        Form has been pre-filled with data from {{ intake_submission.business_name }}'s intake submission.
        You can modify any fields before creating the project.
    </div>
    {% endif %}

    <!-- Project Creation Form -->
    <div class="form-container">
        <form method="POST" action="{{ url_for('create_project') }}">
            <!-- Hidden field for intake submission ID -->
            {% if intake_submission %}
            <input type="hidden" name="intake_submission_id" value="{{ intake_submission.id }}">
            {% endif %}

            <div class="grid md:grid-cols-2 gap-6">
                <!-- Client Information -->
                <div class="form-group">
                    <label for="client_name" class="form-label">Client Name *</label>
                    <input type="text" 
                           id="client_name" 
                           name="client_name" 
                           class="form-input" 
                           value="{% if intake_submission %}{{ intake_submission.contact_name }}{% endif %}"
                           required>
                </div>

                <div class="form-group">
                    <label for="client_email" class="form-label">Client Email *</label>
                    <input type="email" 
                           id="client_email" 
                           name="client_email" 
                           class="form-input" 
                           value="{% if intake_submission %}{{ intake_submission.email }}{% endif %}"
                           required>
                </div>

                <div class="form-group">
                    <label for="client_phone" class="form-label">Client Phone</label>
                    <input type="tel" 
                           id="client_phone" 
                           name="client_phone" 
                           class="form-input" 
                           value="{% if intake_submission %}{{ intake_submission.phone or '' }}{% endif %}">
                </div>

                <!-- Project Information -->
                <div class="form-group">
                    <label for="project_name" class="form-label">Project Name *</label>
                    <input type="text" 
                           id="project_name" 
                           name="project_name" 
                           class="form-input" 
                           value="{% if intake_submission %}{{ intake_submission.business_name }} Website{% endif %}"
                           required>
                </div>

                <div class="form-group">
                    <label for="project_type" class="form-label">Project Type *</label>
                    <select id="project_type" name="project_type" class="form-input form-select" required>
                        <option value="">Select project type</option>
                        <option value="business" {% if intake_submission and intake_submission.website_type == 'business' %}selected{% endif %}>Business Website</option>
                        <option value="ecommerce" {% if intake_submission and intake_submission.website_type == 'ecommerce' %}selected{% endif %}>E-commerce Store</option>
                        <option value="portfolio" {% if intake_submission and intake_submission.website_type == 'portfolio' %}selected{% endif %}>Portfolio Site</option>
                        <option value="blog" {% if intake_submission and intake_submission.website_type == 'blog' %}selected{% endif %}>Blog/Content Site</option>
                        <option value="other" {% if intake_submission and intake_submission.website_type == 'other' %}selected{% endif %}>Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="budget" class="form-label">Budget Range</label>
                    <select id="budget" name="budget" class="form-input form-select">
                        <option value="">Select budget range</option>
                        <option value="under1000" {% if intake_submission and intake_submission.budget == 'under1000' %}selected{% endif %}>Under $1,000</option>
                        <option value="1000-2500" {% if intake_submission and intake_submission.budget == '1000-2500' %}selected{% endif %}>$1,000 - $2,500</option>
                        <option value="2500-5000" {% if intake_submission and intake_submission.budget == '2500-5000' %}selected{% endif %}>$2,500 - $5,000</option>
                        <option value="5000-10000" {% if intake_submission and intake_submission.budget == '5000-10000' %}selected{% endif %}>$5,000 - $10,000</option>
                        <option value="over10000" {% if intake_submission and intake_submission.budget == 'over10000' %}selected{% endif %}>Over $10,000</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="timeline" class="form-label">Project Timeline</label>
                    <select id="timeline" name="timeline" class="form-input form-select">
                        <option value="">Select timeline</option>
                        <option value="asap" {% if intake_submission and intake_submission.timeline == 'asap' %}selected{% endif %}>ASAP (Rush Fee May Apply)</option>
                        <option value="1-2weeks" {% if intake_submission and intake_submission.timeline == '1-2weeks' %}selected{% endif %}>1-2 Weeks</option>
                        <option value="3-4weeks" {% if intake_submission and intake_submission.timeline == '3-4weeks' %}selected{% endif %}>3-4 Weeks</option>
                        <option value="1-2months" {% if intake_submission and intake_submission.timeline == '1-2months' %}selected{% endif %}>1-2 Months</option>
                        <option value="flexible" {% if intake_submission and intake_submission.timeline == 'flexible' %}selected{% endif %}>Flexible</option>
                    </select>
                </div>
            </div>

            <!-- Project Description -->
            <div class="form-group">
                <label for="description" class="form-label">Project Description</label>
                <textarea id="description" 
                          name="description" 
                          class="form-input form-textarea" 
                          placeholder="Detailed description of the project requirements and goals...">{% if intake_submission %}{{ intake_submission.project_description }}{% if intake_submission.additional_notes %}

Additional Notes:
{{ intake_submission.additional_notes }}{% endif %}{% endif %}</textarea>
            </div>

            <!-- Submit Buttons -->
            <div class="grid md:grid-cols-2 gap-4 mt-8">
                <a href="{{ url_for('admin_dashboard') }}" class="btn-cancel">
                    Cancel
                </a>
                <button type="submit" class="btn-submit">
                    Create Project
                </button>
            </div>
        </form>
    </div>
</main>

<script>
// Auto-generate project name based on client name and project type
document.getElementById('project_type').addEventListener('change', function() {
    const clientName = document.getElementById('client_name').value;
    const projectType = this.value;
    const projectNameField = document.getElementById('project_name');
    
    if (clientName && projectType && !projectNameField.dataset.userModified) {
        const typeMap = {
            'business': 'Business Website',
            'ecommerce': 'E-commerce Store',
            'portfolio': 'Portfolio Website',
            'blog': 'Blog Website',
            'other': 'Website'
        };
        
        projectNameField.value = `${clientName} ${typeMap[projectType] || 'Website'}`;
    }
});

// Track user modifications to project name
document.getElementById('project_name').addEventListener('input', function() {
    this.dataset.userModified = 'true';
});

// Auto-update project name when client name changes (if not user-modified)
document.getElementById('client_name').addEventListener('input', function() {
    const projectType = document.getElementById('project_type').value;
    const projectNameField = document.getElementById('project_name');
    
    if (projectType && !projectNameField.dataset.userModified) {
        const typeMap = {
            'business': 'Business Website',
            'ecommerce': 'E-commerce Store',
            'portfolio': 'Portfolio Website',
            'blog': 'Blog Website',
            'other': 'Website'
        };
        
        projectNameField.value = `${this.value} ${typeMap[projectType] || 'Website'}`;
    }
});
</script>
{% endblock %}